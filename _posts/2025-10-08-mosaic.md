---
layout: post
title: "Generating Image Mosaics (and more!)"
published: true
---

# Introduction
This is my third project for CS 180 (Intro to Computer Vision) at UC Berkeley.
The project covers

# Part A.1: Shoot the Pictures
The first part of the assignment is to show at least 2 sets of images with projective transformations between them (fixed center of projection, rotate camera).
The reason we are doing this is because we can then use these images to construct mosaics later on in the assignment.

**Set 1:**
<p align="center">
  <img src="/assets/images/mosaic/input/northside1.jpg" width="500"/>
</p>

<p align="center">
  <img src="/assets/images/mosaic/input/northside2.jpg" width="500"/>
</p>

**Set 2:**
<p align="center">
  <img src="/assets/images/mosaic/input/library1.jpg" width="500"/>
</p>
<p align="center">
  <img src="/assets/images/mosaic/input/library2.jpg" width="500"/>
</p>

Notice how the camera *position* is the same in both sets of images; all we're doing is rotating it.

# Part A.2: Recover Homographies

A **homography** is a 3Ã—3 projective transformation that maps points from one image to another when both images capture the same planar scene.  
In homogeneous coordinates:

```

p2 ~ H p1

```

where `p1 = [x, y, 1]^T`, `p2 = [x', y', w']^T`, and `H` is:

```

[ h11 h12 h13
h21 h22 h23
h31 h32 h33 ]

```

We convert to Cartesian coordinates:
```

x' = (h11*x + h12*y + h13) / (h31*x + h32*y + h33)
y' = (h21*x + h22*y + h23) / (h31*x + h32*y + h33)

```

Rearranging gives two equations per correspondence:

```

x*h11 + y*h12 + 1*h13 - x*x'*h31 - y*x'*h32 = x'
x*h21 + y*h22 + 1*h23 - x*y'*h31 - y*y'*h32 = y'

```

Stacking all pairs yields the linear system `A h = b` with  
`h = [h11 h12 h13 h21 h22 h23 h31 h32]^T`.

I solved this with least squares in `computeH(im1_pts, im2_pts)`.

### Correspondence Points

<p>
<table>
<thead>
<tr><th>#</th><th>im1: x</th><th>im1: y</th><th>im2: x'</th><th>im2: y'</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>547</td><td>483</td><td>149</td><td>476</td></tr>
<tr><td>2</td><td>574</td><td>744</td><td>140</td><td>743</td></tr>
<tr><td>3</td><td>671</td><td>767</td><td>232</td><td>765</td></tr>
<tr><td>4</td><td>724</td><td>775</td><td>278</td><td>771</td></tr>
<tr><td>5</td><td>575</td><td>853</td><td>116</td><td>857</td></tr>
<tr><td>6</td><td>682</td><td>481</td><td>271</td><td>498</td></tr>
<tr><td>7</td><td>522</td><td>430</td><td>120</td><td>417</td></tr>
</tbody>
</table>
</p>

### Recovered Homography Matrix

```

[[ 1.46568340e+00 -1.20053461e-01 -4.98410322e+02]
[ 2.29064746e-01  1.24290079e+00 -1.30462059e+02]
[ 5.01352998e-04 -9.85491138e-05  1.00000000e+00]]

```

### Verification (Reprojection Errors)

<p>
<table>
<thead>
<tr><th>#</th><th>Original</th><th>Projected</th><th>Error (px)</th></tr>
</thead>
<tbody>
<tr><td>1</td><td>(235,705)</td><td>(239.75,700.44)</td><td>6.59</td></tr>
<tr><td>2</td><td>(455,653)</td><td>(456.91,659.37)</td><td>6.65</td></tr>
<tr><td>3</td><td>(71,446)</td><td>(73.94,448.07)</td><td>3.60</td></tr>
<tr><td>4</td><td>(382,424)</td><td>(379.75,424.58)</td><td>2.33</td></tr>
<tr><td>5</td><td>(519,436)</td><td>(517.50,435.57)</td><td>1.57</td></tr>
<tr><td>6</td><td>(530,364)</td><td>(526.74,359.56)</td><td>5.51</td></tr>
<tr><td>7</td><td>(201,454)</td><td>(191.39,452.64)</td><td>9.70</td></tr>
<tr><td>8</td><td>(413,147)</td><td>(417.10,151.08)</td><td>5.78</td></tr>
<tr><td>9</td><td>(419,216)</td><td>(419.63,215.08)</td><td>1.12</td></tr>
<tr><td>10</td><td>(446,292)</td><td>(448.28,290.60)</td><td>2.67</td></tr>
</tbody>
</table>
</p>
The errors in the single digits, which confirms that the code is working properly.
