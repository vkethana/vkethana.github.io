---
layout: post
title: "Generating Image Mosaics (and more!)"
published: true
---

# Introduction
This is my third project for CS 180 (Intro to Computer Vision) at UC Berkeley.
The project covers image warping, image mosaic generation, and corner detection algorithms (to be added to this page soon!)

# Part A.1: Shoot the Pictures
The first part of the assignment is to show at least 2 sets of images with projective transformations between them (fixed center of projection, rotate camera).
The reason we are doing this is because we can then use these images to construct mosaics later on in the assignment.

**Set 1:**
<p align="center">
  <img src="/assets/images/mosaic/input/northside1.jpg" width="500"/>
</p>

<p align="center">
  <img src="/assets/images/mosaic/input/northside2.jpg" width="500"/>
</p>

**Set 2:**
<p align="center">
  <img src="/assets/images/mosaic/input/library1.jpg" width="500"/>
</p>
<p align="center">
  <img src="/assets/images/mosaic/input/library2.jpg" width="500"/>
</p>

Notice how the camera *position* is the same in both sets of images; all we're doing is rotating it.

# Part A.2: Recover Homographies

A **homography** is a 3Ã—3 projective transformation that maps points from one image to another when both images capture the same planar scene.  

For this exercise, consider the below two images:

<p align="center">
  <img src="/assets/images/mosaic/input/library_compare.jpeg" width="500"/>
</p>

Observe that I manually selected **correspondence points** between the two images.
These are necessary to align the images properly.
Only four points are strictly necessary for the algorithm to work, but in practice it makes sense to select many more than four for redundancy.

In homogeneous coordinates: `p2 = Hp1`, 
where `p1 = [x, y, 1]^T`, `p2 = [x', y', w']^T`, and `H` is:

```
[ h11 h12 h13
h21 h22 h23
h31 h32 h33 ]
```

We convert the system to Cartesian coordinates by dividing by the 'scaling factor' introduced by the Homogeneous coordinates:

```
x' = (h11*x + h12*y + h13) / (h31*x + h32*y + h33)
y' = (h21*x + h22*y + h23) / (h31*x + h32*y + h33)
```
Rearranging gives two equations per correspondence:
```
x*h11 + y*h12 + 1*h13 - x*x'*h31 - y*x'*h32 = x'*h33
x*h21 + y*h22 + 1*h23 - x*y'*h31 - y*y'*h32 = y'*h33
```

Setting `h33` to 1 as discussed in class, **we arrive at the system of equations:**

```
x' = x*h11 + y*h12 + 1*h13 - x*x'*h31 - y*x'*h32 
y' = x*h21 + y*h22 + 1*h23 - x*y'*h31 - y*y'*h32 
```

Stacking all pairs yields the linear system `Ah = b` with  
`h = [h11 h12 h13 h21 h22 h23 h31 h32]^T`.
I solved the resulting system of equations using least-squares (because we have >4 correspondences, the system is overdetermined).

This is the homography matrix H which I recovered:
```
[[ 1.46568340e+00 -1.20053461e-01 -4.98410322e+02]
[ 2.29064746e-01  1.24290079e+00 -1.30462059e+02]
[ 5.01352998e-04 -9.85491138e-05  1.00000000e+00]]
```
